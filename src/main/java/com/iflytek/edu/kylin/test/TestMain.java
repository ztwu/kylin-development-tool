package com.iflytek.edu.kylin.test;

import com.iflytek.edu.kylin.client.KylinBackups;
import com.iflytek.edu.kylin.tool.KylinApiUtil;
import org.apache.log4j.Logger;

/**
 * Created with Intellij IDEA.
 * User: ztwu2
 * Date: 2018/5/3
 * Time: 8:54
 * Description
 */

public class TestMain {

    private static final Logger logger = Logger.getLogger(TestMain.class);

    public static void main(String[] args) {

        try {
            //登录验证
            String login = KylinApiUtil.login();
            System.out.println(login);

//            String test= KylinApiUtil.listCubes(0,10,"exam","edu_edmp_gzqz");
//              String test = KylinApiUtil.getCube("edu_edmp_gzqz_exam_user_exam_cube_suffix_test1");
//              String test = KylinApiUtil.getCubeDes("edu_edmp_base_dev_user_area_history_cube_clone2");
//              String test = KylinApiUtil.getDataModel("edu_edmp_gzqz_exam_user_exam_model_suffix_test1");

//            String modelTemp = "{\"modelDescData\":\"{  \\\"name\\\": \\\"edu_edcc_1d2ev_ceshi12345678t91113111345\\\",  \\\"name_prefix\\\": \\\"edu_edcc_dev_\\\",  \\\"name_define\\\": \\\"ceshi123456789\\\",  \\\"description\\\": \\\"\\\", \\\"fact_table\\\": \\\"EDU_BG_HOUSE.DW_UC_ORG_SCHOOL\\\",  \\\"lookups\\\": [], \\\"filter_condition\\\": \\\"\\\",  \\\"dimensions\\\": [   {      \\\"table\\\": \\\"EDU_BG_HOUSE.DW_UC_ORG_SCHOOL\\\",\\n      \\\"columns\\\": [\\n        \\\"SCHOOL_ID\\\"\\n      ]\\n    }\\n  ],\\n  \\\"metrics\\\": [\\n    \\\"SCHOOL_ID\\\"\\n  ],\\n  \\\"partition_desc\\\": {\\n    \\\"partition_date_column\\\": null,\\n    \\\"partition_date_start\\\": null,\\n    \\\"partition_type\\\": \\\"APPEND\\\",\\n    \\\"partition_date_format\\\": \\\"yyyy-MM-dd\\\",\\n    \\\"partition_time_column\\\": null,\\n    \\\"partition_time_start\\\": null\\n  },\\n  \\\"last_modified\\\": 0\\n}\",\"project\":\"edu_edcc_dev\"}";
//            String modelTemp = "{\"modelDescData\":\"{\\\"name_prefix\\\":\\\"edu_edmp_base_dev\\\",\\\"filter_condition\\\":\\\"\\\",\\\"name\\\":\\\"edu_edmp_base_dev_exam_user_examceshi_api\\\",\\\"name_define\\\":\\\"exam_user_examceshi_api\\\",\\\"description\\\":\\\"用户考试报告model\\\",\\\"metrics\\\":[\\\"CLASS_RANK\\\",\\\"SCHOOL_RANK\\\"],\\\"last_modified\\\":0,\\\"fact_table\\\":\\\"EDU_EDMP_BASE_DEV.FACT_USER_EXAM\\\",\\\"dimensions\\\":[{\\\"columns\\\":[\\\"SCHOOL_ID\\\",\\\"USER_ID\\\",\\\"USER_NAME\\\",\\\"GRADE_CODE\\\",\\\"EXAM_ID\\\",\\\"EXAM_TYPE_CODE\\\",\\\"EXAM_NAME\\\",\\\"EXAM_DATE\\\"],\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.FACT_USER_EXAM\\\"},{\\\"columns\\\":[\\\"PROVINCE_ID\\\",\\\"PROVINCE_NAME\\\",\\\"CITY_ID\\\",\\\"CITY_NAME\\\",\\\"DISTRICT_ID\\\",\\\"DISTRICT_NAME\\\",\\\"SCHOOL_NAME\\\"],\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.DIM_SCHOOL\\\"},{\\\"columns\\\":[\\\"YEAR\\\",\\\"MONTH\\\",\\\"WEEK\\\",\\\"TERM\\\",\\\"SCHOOL_YEAR\\\"],\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.DIM_DATE\\\"}],\\\"partition_desc\\\":{\\n    \\\"partition_date_column\\\": null,\\n    \\\"partition_date_start\\\": null,\\n    \\\"partition_type\\\": \\\"APPEND\\\",\\n    \\\"partition_date_format\\\": \\\"yyyy-MM-dd\\\",\\n    \\\"partition_time_column\\\": null,\\n    \\\"partition_time_start\\\": null\\n  }}\",\"project\":\"edu_edmp_base_dev\"}";
            String modelTemp = "{\"modelDescData\":\"{\\\"lookups\\\":[{\\\"join\\\":{\\\"foreign_key\\\":[\\\"EXAM_DATE\\\"],\\\"type\\\":\\\"left\\\",\\\"primary_key\\\":[\\\"DAY\\\"]},\\\"table\\\":\\\"EDU_EDMP_CCCY.DIM_DATE\\\"}],\\\"name_prefix\\\":\\\"edu_edmp_cccy\\\",\\\"filter_condition\\\":\\\"\\\",\\\"name\\\":\\\"edu_edmp_cccy_exam_union_exam_area\\\",\\\"name_define\\\":\\\"exam_union_exam_area\\\",\\\"description\\\":\\\"区域联考报告model\\\",\\\"metrics\\\":[\\\"EXAM_AVG\\\"],\\\"last_modified\\\":0,\\\"fact_table\\\":\\\"EDU_EDMP_CCCY.FACT_UNION_EXAM_AREA\\\",\\\"dimensions\\\":[{\\\"columns\\\":[\\\"AREA_ID\\\",\\\"AREA_NAME\\\",\\\"AREA_LEVEL\\\",\\\"GRADE_CODE\\\",\\\"EXAM_ID\\\",\\\"EXAM_NAME\\\",\\\"EXAM_DATE\\\",\\\"PRE_AREA_ID\\\"],\\\"table\\\":\\\"EDU_EDMP_CCCY.FACT_UNION_EXAM_AREA\\\"},{\\\"columns\\\":[\\\"YEAR\\\",\\\"MONTH\\\",\\\"WEEK\\\",\\\"TERM\\\",\\\"SCHOOL_YEAR\\\"],\\\"table\\\":\\\"EDU_EDMP_CCCY.DIM_DATE\\\"}],\\\"partition_desc\\\":{\\\"partition_date_format\\\":\\\"yyyy-MM-dd\\\",\\\"partition_condition_builder\\\":\\\"org.apache.kylin.metadata.model.PartitionDesc$DefaultPartitionConditionBuilder\\\",\\\"partition_time_column\\\":null,\\\"partition_date_start\\\":0,\\\"partition_time_format\\\":\\\"HH:mm:ss\\\",\\\"partition_date_column\\\":null,\\\"partition_type\\\":\\\"APPEND\\\"}}\",\"project\":\"edu_edmp_cccy\"}";
//            String test = KylinApiUtil.createModel(modelTemp);

//            String cubeTemp = "{\"cubeDescData\":\"{\\n  \\\"name\\\": \\\"edu_edcc_dev_ceshi11123\\\",\\n  \\\"name_prefix\\\": \\\"edu_edcc_dev_\\\",\\n  \\\"model_name\\\": \\\"edu_edcc_dev_ceshi123\\\",\\n  \\\"model_define\\\": \\\"\\\",\\n  \\\"description\\\": \\\"\\\",\\n  \\\"dimensions\\\": [\\n    {\\n      \\\"name\\\": \\\"SCHOOL_ID\\\",\\n      \\\"table\\\": \\\"EDU_BG_HOUSE.DW_UC_ORG_SCHOOL\\\",\\n      \\\"derived\\\": null,\\n      \\\"column\\\": \\\"SCHOOL_ID\\\"\\n    }\\n  ],\\n  \\\"measures\\\": [\\n    {\\n      \\\"name\\\": \\\"_COUNT_\\\",\\n      \\\"function\\\": {\\n        \\\"expression\\\": \\\"COUNT\\\",\\n        \\\"returntype\\\": \\\"bigint\\\",\\n        \\\"parameter\\\": {\\n          \\\"type\\\": \\\"constant\\\",\\n          \\\"value\\\": \\\"1\\\",\\n          \\\"next_parameter\\\": null\\n        },\\n        \\\"configuration\\\": {}\\n      }\\n    }\\n  ],\\n  \\\"dictionaries\\\": [],\\n  \\\"rowkey\\\": {\\n    \\\"rowkey_columns\\\": [\\n      {\\n        \\\"column\\\": \\\"SCHOOL_ID\\\",\\n        \\\"encoding\\\": \\\"dict\\\",\\n        \\\"isShardBy\\\": \\\"false\\\"\\n      }\\n    ]\\n  },\\n  \\\"aggregation_groups\\\": [\\n    {\\n      \\\"includes\\\": [\\n        \\\"SCHOOL_ID\\\"\\n      ],\\n      \\\"select_rule\\\": {\\n        \\\"hierarchy_dims\\\": [],\\n        \\\"mandatory_dims\\\": [],\\n        \\\"joint_dims\\\": []\\n      }\\n    }\\n  ],\\n  \\\"partition_date_start\\\": 0,\\n  \\\"notify_list\\\": [],\\n  \\\"hbase_mapping\\\": {\\n    \\\"column_family\\\": [\\n      {\\n        \\\"name\\\": \\\"f1\\\",\\n        \\\"columns\\\": [\\n          {\\n            \\\"qualifier\\\": \\\"m\\\",\\n            \\\"measure_refs\\\": [\\n              \\\"_COUNT_\\\"\\n            ]\\n          }\\n        ]\\n      }\\n    ]\\n  },\\n  \\\"retention_range\\\": \\\"0\\\",\\n  \\\"status_need_notify\\\": [\\n    \\\"ERROR\\\",\\n    \\\"DISCARDED\\\",\\n    \\\"SUCCEED\\\"\\n  ],\\n  \\\"auto_merge_time_ranges\\\": [\\n    604800000,\\n    2419200000\\n  ],\\n  \\\"engine_type\\\": 2,\\n  \\\"storage_type\\\": 2,\\n  \\\"override_kylin_properties\\\": {\\n    \\\"kylin.job.mr.config.override.mapreduce.job.queuename\\\": \\\"edu_edcc_dev\\\",\\n    \\\"kylin.hive.config.override.mapreduce.job.queuename\\\": \\\"edu_edcc_dev\\\"\\n  },\\n  \\\"name_define\\\": \\\"ceshi\\\"\\n}\",\"project\":\"edu_edcc_dev\"}";
            String cubeTemp = "{\"project\":\"edu_edmp_base_dev\",\"cubeDescData\":\"{\\\"storage_type\\\":2,\\\"status_need_notify\\\":[\\\"ERROR\\\",\\\"DISCARDED\\\",\\\"SUCCEED\\\"],\\\"auto_merge_time_ranges\\\":[604800000,2419200000],\\\"name_define\\\":\\\"exam_user_examceshi_api\\\",\\\"description\\\":\\\"\\\",\\\"notify_list\\\":[],\\\"override_kylin_properties\\\":{\\\"kylin.hive.config.override.mapreduce.job.queuename\\\":\\\"edu_edmp_base_dev\\\",\\\"kylin.job.mr.config.override.mapreduce.job.queuename\\\":\\\"edu_edmp_base_dev\\\"},\\\"partition_date_start\\\":0,\\\"name_prefix\\\":\\\"edu_edmp_base_dev\\\",\\\"measures\\\":[{\\\"dependent_measure_ref\\\":null,\\\"function\\\":{\\\"expression\\\":\\\"COUNT\\\",\\\"parameter\\\":{\\\"next_parameter\\\":null,\\\"type\\\":\\\"constant\\\",\\\"value\\\":\\\"1\\\"},\\\"returntype\\\":\\\"bigint\\\"},\\\"name\\\":\\\"_COUNT_\\\"},{\\\"dependent_measure_ref\\\":null,\\\"function\\\":{\\\"expression\\\":\\\"SUM\\\",\\\"parameter\\\":{\\\"next_parameter\\\":null,\\\"type\\\":\\\"column\\\",\\\"value\\\":\\\"CLASS_RANK\\\"},\\\"returntype\\\":\\\"bigint\\\"},\\\"name\\\":\\\"班级排名\\\"},{\\\"dependent_measure_ref\\\":null,\\\"function\\\":{\\\"expression\\\":\\\"SUM\\\",\\\"parameter\\\":{\\\"next_parameter\\\":null,\\\"type\\\":\\\"column\\\",\\\"value\\\":\\\"SCHOOL_RANK\\\"},\\\"returntype\\\":\\\"bigint\\\"},\\\"name\\\":\\\"学校排名\\\"}],\\\"engine_type\\\":2,\\\"model_name\\\":\\\"edu_edmp_base_dev_exam_user_examceshi_api\\\",\\\"hbase_mapping\\\":{\\\"column_family\\\":[{\\\"columns\\\":[{\\\"qualifier\\\":\\\"M\\\",\\\"measure_refs\\\":[\\\"_COUNT_\\\",\\\"班级排名\\\",\\\"学校排名\\\"]}],\\\"name\\\":\\\"F1\\\"}]},\\\"retention_range\\\":0,\\\"name\\\":\\\"edu_edmp_base_dev_exam_user_examceshi_api\\\",\\\"rowkey\\\":{\\\"rowkey_columns\\\":[{\\\"column\\\":\\\"EXAM_DATE\\\",\\\"isShardBy\\\":true,\\\"encoding\\\":\\\"dict\\\"},{\\\"column\\\":\\\"SCHOOL_ID\\\",\\\"isShardBy\\\":false,\\\"encoding\\\":\\\"dict\\\"},{\\\"column\\\":\\\"DISTRICT_ID\\\",\\\"isShardBy\\\":false,\\\"encoding\\\":\\\"dict\\\"},{\\\"column\\\":\\\"CITY_ID\\\",\\\"isShardBy\\\":false,\\\"encoding\\\":\\\"dict\\\"},{\\\"column\\\":\\\"PROVINCE_ID\\\",\\\"isShardBy\\\":false,\\\"encoding\\\":\\\"dict\\\"},{\\\"column\\\":\\\"USER_ID\\\",\\\"isShardBy\\\":false,\\\"encoding\\\":\\\"fixed_length:25\\\"},{\\\"column\\\":\\\"USER_NAME\\\",\\\"isShardBy\\\":false,\\\"encoding\\\":\\\"fixed_length:25\\\"},{\\\"column\\\":\\\"EXAM_ID\\\",\\\"isShardBy\\\":false,\\\"encoding\\\":\\\"dict\\\"},{\\\"column\\\":\\\"GRADE_CODE\\\",\\\"isShardBy\\\":false,\\\"encoding\\\":\\\"dict\\\"},{\\\"column\\\":\\\"EXAM_TYPE_CODE\\\",\\\"isShardBy\\\":false,\\\"encoding\\\":\\\"dict\\\"},{\\\"column\\\":\\\"EXAM_NAME\\\",\\\"isShardBy\\\":false,\\\"encoding\\\":\\\"dict\\\"}]},\\\"aggregation_groups\\\":[{\\\"select_rule\\\":{\\\"mandatory_dims\\\":[\\\"PROVINCE_ID\\\",\\\"CITY_ID\\\",\\\"DISTRICT_ID\\\",\\\"SCHOOL_ID\\\",\\\"USER_ID\\\",\\\"USER_NAME\\\",\\\"GRADE_CODE\\\",\\\"EXAM_ID\\\",\\\"EXAM_TYPE_CODE\\\",\\\"EXAM_NAME\\\",\\\"EXAM_DATE\\\"],\\\"hierarchy_dims\\\":[],\\\"joint_dims\\\":[]},\\\"includes\\\":[\\\"SCHOOL_ID\\\",\\\"USER_ID\\\",\\\"USER_NAME\\\",\\\"GRADE_CODE\\\",\\\"EXAM_ID\\\",\\\"EXAM_TYPE_CODE\\\",\\\"EXAM_NAME\\\",\\\"EXAM_DATE\\\",\\\"DISTRICT_ID\\\",\\\"CITY_ID\\\",\\\"PROVINCE_ID\\\"]}],\\\"model_define\\\":\\\"exam_user_examceshi_api\\\",\\\"dimensions\\\":[{\\\"name\\\":\\\"SCHOOL_ID\\\",\\\"column\\\":\\\"SCHOOL_ID\\\",\\\"derived\\\":null,\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.FACT_USER_EXAM\\\"},{\\\"name\\\":\\\"USER_ID\\\",\\\"column\\\":\\\"USER_ID\\\",\\\"derived\\\":null,\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.FACT_USER_EXAM\\\"},{\\\"name\\\":\\\"USER_NAME\\\",\\\"column\\\":\\\"USER_NAME\\\",\\\"derived\\\":null,\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.FACT_USER_EXAM\\\"},{\\\"name\\\":\\\"GRADE_CODE\\\",\\\"column\\\":\\\"GRADE_CODE\\\",\\\"derived\\\":null,\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.FACT_USER_EXAM\\\"},{\\\"name\\\":\\\"EXAM_ID\\\",\\\"column\\\":\\\"EXAM_ID\\\",\\\"derived\\\":null,\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.FACT_USER_EXAM\\\"},{\\\"name\\\":\\\"EXAM_TYPE_CODE\\\",\\\"column\\\":\\\"EXAM_TYPE_CODE\\\",\\\"derived\\\":null,\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.FACT_USER_EXAM\\\"},{\\\"name\\\":\\\"EXAM_NAME\\\",\\\"column\\\":\\\"EXAM_NAME\\\",\\\"derived\\\":null,\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.FACT_USER_EXAM\\\"},{\\\"name\\\":\\\"EXAM_DATE\\\",\\\"column\\\":\\\"EXAM_DATE\\\",\\\"derived\\\":null,\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.FACT_USER_EXAM\\\"},{\\\"name\\\":\\\"SCHOOL_NAME\\\",\\\"column\\\":null,\\\"derived\\\":[\\\"SCHOOL_NAME\\\"],\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.DIM_SCHOOL\\\"},{\\\"name\\\":\\\"DISTRICT_ID\\\",\\\"column\\\":\\\"DISTRICT_ID\\\",\\\"derived\\\":null,\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.DIM_SCHOOL\\\"},{\\\"name\\\":\\\"DISTRICT_NAME\\\",\\\"column\\\":null,\\\"derived\\\":[\\\"DISTRICT_NAME\\\"],\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.DIM_SCHOOL\\\"},{\\\"name\\\":\\\"CITY_ID\\\",\\\"column\\\":\\\"CITY_ID\\\",\\\"derived\\\":null,\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.DIM_SCHOOL\\\"},{\\\"name\\\":\\\"CITY_NAME\\\",\\\"column\\\":null,\\\"derived\\\":[\\\"CITY_NAME\\\"],\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.DIM_SCHOOL\\\"},{\\\"name\\\":\\\"PROVINCE_ID\\\",\\\"column\\\":\\\"PROVINCE_ID\\\",\\\"derived\\\":null,\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.DIM_SCHOOL\\\"},{\\\"name\\\":\\\"PROVINCE_NAME\\\",\\\"column\\\":null,\\\"derived\\\":[\\\"PROVINCE_NAME\\\"],\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.DIM_SCHOOL\\\"},{\\\"name\\\":\\\"YEAR\\\",\\\"column\\\":null,\\\"derived\\\":[\\\"YEAR\\\"],\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.DIM_DATE\\\"},{\\\"name\\\":\\\"MONTH\\\",\\\"column\\\":null,\\\"derived\\\":[\\\"MONTH\\\"],\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.DIM_DATE\\\"},{\\\"name\\\":\\\"WEEK\\\",\\\"column\\\":null,\\\"derived\\\":[\\\"WEEK\\\"],\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.DIM_DATE\\\"},{\\\"name\\\":\\\"SCHOOL_YEAR\\\",\\\"column\\\":null,\\\"derived\\\":[\\\"SCHOOL_YEAR\\\"],\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.DIM_DATE\\\"},{\\\"name\\\":\\\"TERM\\\",\\\"column\\\":null,\\\"derived\\\":[\\\"TERM\\\"],\\\"table\\\":\\\"EDU_EDMP_BASE_DEV.DIM_DATE\\\"}],\\\"dictionaries\\\":[]}\"}";
//            String test = KylinApiUtil.createCube(cubeTemp);

//            String test = KylinApiUtil.loadHiveTable("","","{\"calculate\":true}");
//            String test = KylinApiUtil.getHiveTables("edu_edmp_base_dev",true);
//            String test = KylinApiUtil.getHiveTable("EDU_EDMP_BASE_DEV.DIM_SCHOOL");

//            String test = KylinApiUtil.deleteModel("edu_edmp_gzqz_exam_user_exam_model_suffix_test1");
//            String test = KylinApiUtil.deleteCube("edu_edmp_ahhn_exam_exam_overview");
//            System.out.println(test);
        } catch (Exception e){
            logger.error(e.getMessage());
        }
    }

}
